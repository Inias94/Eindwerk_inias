{% extends "base.html" %}

{% block content %}
  <h2>Create a New Dish</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div>
      {{ form.non_field_errors }}
      <div>
        <label for="{{ dish_form.name.id_for_label }}">Dish Name:</label>
        {{ form.name }}
      </div>
      <div>
        <label for="{{ dish_form.recipe.id_for_label }}">Recipe:</label>
        {{ form.recipe }}
      </div>
      <!-- Add more fields from DishForm here if needed -->
    </div>
    <h3>Products</h3>
    {{ formset.management_form }}
    <table id="product-table">
      {% for form in formset %}
        <tr class="formset-form">
          <td>{{ form.as_p }}</td>
        </tr>
      {% endfor %}
    </table>
    <button type="button" id="add-more">Add another product</button>
    <br>
    <button type="submit">Save</button>
  </form>

  <script>
    document.getElementById('add-more').addEventListener('click', function() {
      var formIdx = document.querySelectorAll('.formset-form').length;
      var newForm = document.querySelector('.formset-form').cloneNode(true);
      var regex = new RegExp('form-' + (formIdx - 1), 'g');
      newForm.innerHTML = newForm.innerHTML.replace(regex, 'form-' + formIdx);
      document.querySelector('table').appendChild(newForm);
      document.querySelector('#id_form-TOTAL_FORMS').value = formIdx + 1;
    });
  </script>
{% endblock %}
